function GridBackground(t){this.graph=t,t.onPropertyChange("viewport",this.update.bind(this)),t.onPropertyChange("transform",this.update.bind(this)),this.canvas=Q.createCanvas(t.width,t.height,!0),this.canvas.style.position="absolute",this.canvas.style.top="0px",this.canvas.style["-webkit-user-select"]="none",this.canvas.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)",this.scaleCanvas=Q.createCanvas(t.width,t.height,!0),this.scaleCanvas.style.position="absolute",this.scaleCanvas.style.top="0px",this.scaleCanvas.style["-webkit-user-select"]="none",this.scaleCanvas.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)",t.canvasPanel.insertBefore(this.canvas,t.canvasPanel.firstChild),t.canvasPanel.appendChild(this.scaleCanvas),this.update()}function getI18NString(t){if(!i18n[lang])return t;var e=i18n[lang][t];return void 0===e?t:e}!function(t){function e(t,e,n){var i=t.offsetWidth,o=t.offsetHeight;t.style.left=e-i/2+"px",t.style.top=n-o/2+"px"}t.showDivCenterAt=e}(Q),!function(t,e){var n=function(t){t=t||{};var n=document.createElement(t.tagName||"div");return t.class&&e(n).addClass(t.class),t.parent&&t.parent.appendChild(n),t.style&&n.setAttribute("style",t.style),t.css&&e(n).css(t.css),t.html&&e(n).html(t.html),n};t.createElement=n}(Q,jQuery),!function(t){function e(t){t=t||window.event;var e=t.dataTransfer,n=t.target;e.setData("text",n.getAttribute(o))}function n(t,e,n,o){var r=document.createElement("img");return r.src=e,r.setAttribute("title",n),o=o||{},o.label=o.label||n,o.title=n,o.image||o.type&&"Node"!=o.type||(o.image=e),i(r,o),t.appendChild(r),r}function i(n,i){return n.setAttribute("draggable","true"),n.setAttribute(o,t.exportJSON?t.exportJSON(i,!0):JSON.stringify(i)),n.ondragstart=e,n}var o="draginfo",r=/MSIE 9/i.test(navigator.userAgent)||/MSIE 10/i.test(navigator.userAgent),a=!r;if(!a){var s={},l=function(t){return{x:t.pageX,y:t.pageY}},h=document.documentElement,u=function(){h.addEventListener("mousemove",function(e){if(s.target){t.stopEvent(e);var n=l(e);if(!s.dragElement){var i=s.target;if(Math.abs(n.x-s.dragPoint.x)<=5||Math.abs(n.y-s.dragPoint.y)<=5)return;var o=document.createElement("div");o.style.position="absolute",o.style.zIndex=1e4;var r=i.cloneNode(!0);/canvas/i.test(r.tagName)?r.getContext("2d").drawImage(i,0,0):(o.style.maxWidth="30px",o.style.maxWidth="30px",o.style.cursor="move"),r.id=null,o.appendChild(r),h.appendChild(o),s.dragElement=o;var a={target:i};i.ondragstart instanceof Function&&(s.dataTransfer=a.dataTransfer={datas:{},setData:function(t,e){this.datas[t]=e},getData:function(t){return this.datas[t]}},i.ondragstart(a))}s.dragElement.style.left=n.x-s.dragElement.clientWidth/2+"px",s.dragElement.style.top=n.y-s.dragElement.clientHeight/2+"px"}},!1),h.addEventListener("mouseup",function(t){if(s.target){delete s.dragPoint,delete s.target,s.dragElement&&(h.removeChild(s.dragElement),delete s.dragElement);for(var e=l(t),n=document.getElementsByClassName("Q-Graph"),i=0;i<n.length;){var o=n[i];++i;var r=p(o);if(d(r,e)){o.ondrop instanceof Function&&(t.dataTransfer=s.dataTransfer,o.ondrop(t));break}}delete s.dataTransfer}},!1)},d=function(t,e){return e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height},c=function(t){for(var e=0,n=0;t.offsetParent;)e+=t.clientLeft+t.offsetLeft-t.scrollLeft,n+=t.clientTop+t.offsetTop-t.scrollTop,t=t.offsetParent;return{x:e,y:n}},p=function(t){var e=c(t),n=e.x+t.scrollLeft,i=e.y+t.scrollTop,o=t.clientWidth,r=t.clientHeight;return{x:n,y:i,left:n,top:i,right:n+o,bottom:i+r,width:o,height:r}},f=function(e){return e.onmousedown=function(n){s.dragPoint=l(n),s.target=e,t.stopEvent(n)},e};i=function(t,n){return t.setAttribute("draggable","true"),t.setAttribute(o,JSON.stringify(n)),t.ondragstart=e,f(t),t},u()}t.createDNDImage=n,t.appendDNDInfo=i}(Q),function(t,e){function n(e,n){this.onBoundsChange=n,this.parent=e,this.handleSize=t.isTouchSupport?20:8,this.boundsDiv=this._createDiv(this.parent),this.boundsDiv.type="border",this.boundsDiv.style.position="absolute",this.boundsDiv.style.border="dashed 1px #888";var i="lt,t,rt,l,r,lb,b,rb";i=i.split(",");for(var o=0,r=i.length;o<r;o++){var a=i[o],s=this._createDiv(this.parent);s.type="handle",s.name=a,s.style.position="absolute",s.style.backgroundColor="#FFF",s.style.border="solid 1px #555",s.style.width=s.style.height=this.handleSize+"px";var l;l="lt"==a||"rb"==a?"nwse-resize":"rt"==a||"lb"==a?"nesw-resize":"t"==a||"b"==a?"ns-resize":"ew-resize",s.style.cursor=l,this[i[o]]=s}this.interaction=new t.DragSupport(this.parent,this)}function i(){var t=e("<div/>").html(r).contents();this.html=t=t[0],document.body.appendChild(this.html),t.addEventListener("mousedown",function(e){e.target==t&&this.destroy()}.bind(this),!1);var n=this._getChild(".graph-export-panel__export_scale"),i=this._getChild(".graph-export-panel__export_scale_label");n.onchange=function(t){i.textContent=this.scale=n.value,this.updateOutputSize()}.bind(this),this.export_scale=n;var o=function(t){var e=this.exportImageInfo();if(e){var n=e.canvas,i=this.graph.name||"graph";n.toBlob(function(e){t(e,i+".png")},"image/png")}},a=function(t,e){var n=this.exportImageInfo();if(n){var i=window.open(),o=i.document;o.title=this.graph.name||"";var r=o.createElement("img");if(r.src=n.data,o.body.style.textAlign="center",o.body.style.margin="0px",o.body.appendChild(r),t===!0){var a=o.createElement("style");a.setAttribute("type","text/css"),a.setAttribute("media","print");var s="img {max-width: 100%; max-height: 100%;}";this.clipBounds.width/this.clipBounds.height>1.2&&(s+="\n @page { size: landscape; }"),a.appendChild(document.createTextNode(s)),o.head.appendChild(a),r.style.maxWidth="100%",r.style.maxHeight="100%",setTimeout(function(){i.print(),i.onfocus=function(){i.close()}},100)}}},s=this._getChild(".graph-export-panel__export_submit");window.saveAs&&HTMLCanvasElement.prototype.toBlob?s.onclick=o.bind(this,window.saveAs):s.onclick=a.bind(this);var l=this._getChild(".graph-export-panel__print_submit");l.onclick=a.bind(this,!0)}function o(t){a||(a=new i),a.show(t)}var r='<div class="graph-export-panel modal fade">  <div class="modal-dialog">  <div class="modal-content">  <div class="modal-body">  <h3 style="text-align: center;">图片导出预览</h3>  <div>  <label>画布大小</label>  <span class ="graph-export-panel__canvas_size"></span>  </div>  <div style="text-align: center;" title="双击选择全画布范围">  <div class ="graph-export-panel__export_canvas" style="position: relative; display: inline-block;">  </div>  </div>  <div>  <label>导出范围</label>  <span class ="graph-export-panel__export_bounds"></span>  </div>  <div>  <label>缩放比例: <input class ="graph-export-panel__export_scale" type="range" value="1" step="0.2" min="0.2" max="3"><span class ="graph-export-panel__export_scale_label">1</span></label>  </div>  <div>  <label>输出大小: </label><span class ="graph-export-panel__export_size"></span>  </div>  <div style="text-align: right">  <button type="submit" class="btn btn-primary graph-export-panel__export_submit">导出</button>  <button type="submit" class="btn btn-primary graph-export-panel__print_submit">打印</button>  </div>  </div>  </div>  </div>  </div>';n.prototype={destroy:function(){this.interaction.destroy()},update:function(e,n){this.wholeBounds=new t.Rect(0,0,e,n),this._setBounds(this.wholeBounds.clone())},ondblclick:function(t){return this._bounds.equals(this.wholeBounds)?(this.oldBounds||(this.oldBounds=this.wholeBounds.clone().grow(-this.wholeBounds.height/5,-this.wholeBounds.width/5)),void this._setBounds(this.oldBounds,!0)):void this._setBounds(this.wholeBounds.clone(),!0)},startdrag:function(t){t.target.type&&(this.dragItem=t.target)},ondrag:function(e){if(this.dragItem){t.stopEvent(e);var n=e.dx,i=e.dy;if("border"==this.dragItem.type)this._bounds.offset(n,i),this._setBounds(this._bounds,!0);else if("handle"==this.dragItem.type){var o=this.dragItem.name;"l"==o[0]?(this._bounds.x+=n,this._bounds.width-=n):"r"==o[0]&&(this._bounds.width+=n),"t"==o[o.length-1]?(this._bounds.y+=i,this._bounds.height-=i):"b"==o[o.length-1]&&(this._bounds.height+=i),this._setBounds(this._bounds,!0)}}},enddrag:function(t){this.dragItem&&(this.dragItem=!1,this._bounds.width<0?(this._bounds.x+=this._bounds.width,this._bounds.width=-this._bounds.width):0==this._bounds.width&&(this._bounds.width=1),this._bounds.height<0?(this._bounds.y+=this._bounds.height,this._bounds.height=-this._bounds.height):0==this._bounds.height&&(this._bounds.height=1),this._bounds.width>this.wholeBounds.width&&(this._bounds.width=this.wholeBounds.width),this._bounds.height>this.wholeBounds.height&&(this._bounds.height=this.wholeBounds.height),this._bounds.x<0&&(this._bounds.x=0),this._bounds.y<0&&(this._bounds.y=0),this._bounds.right>this.wholeBounds.width&&(this._bounds.x-=this._bounds.right-this.wholeBounds.width),this._bounds.bottom>this.wholeBounds.height&&(this._bounds.y-=this._bounds.bottom-this.wholeBounds.height),this._setBounds(this._bounds,!0))},_createDiv:function(t){var e=document.createElement("div");return t.appendChild(e),e},_setHandleLocation:function(t,e,n){t.style.left=e-this.handleSize/2+"px",t.style.top=n-this.handleSize/2+"px"},_setBounds:function(t){t.equals(this.wholeBounds)||(this.oldBounds=t),this._bounds=t,t=t.clone(),t.width+=1,t.height+=1,this.boundsDiv.style.left=t.x+"px",this.boundsDiv.style.top=t.y+"px",this.boundsDiv.style.width=t.width+"px",this.boundsDiv.style.height=t.height+"px",this._setHandleLocation(this.lt,t.x,t.y),this._setHandleLocation(this.t,t.cx,t.y),this._setHandleLocation(this.rt,t.right,t.y),this._setHandleLocation(this.l,t.x,t.cy),this._setHandleLocation(this.r,t.right,t.cy),this._setHandleLocation(this.lb,t.x,t.bottom),this._setHandleLocation(this.b,t.cx,t.bottom),this._setHandleLocation(this.rb,t.right,t.bottom),this.onBoundsChange&&this.onBoundsChange(this._bounds)}},Object.defineProperties(n.prototype,{bounds:{get:function(){return this._bounds},set:function(t){this._setBounds(t)}}}),i.prototype={canvas:null,html:null,exportImageInfo:function(e){var e=this.graph;if(e){var n=this.export_scale.value,i=this.imageInfo.scale,o=new t.Rect(this.clipBounds.x/i,this.clipBounds.y/i,this.clipBounds.width/i,this.clipBounds.height/i);o.offset(this.bounds.x,this.bounds.y);var r=e.exportImage(n,o);if(r&&r.data)return r}},_getChild:function(t){return e(this.html).find(t)[0]},initCanvas:function(){var e=this._getChild(".graph-export-panel__export_canvas");e.innerHTML="";var i=t.createCanvas(!0);e.appendChild(i),this.canvas=i;var o,r=this._getChild(".graph-export-panel__export_bounds"),a=this._getChild(".graph-export-panel__export_size"),s=function(){var t=this.canvas,e=t.g,n=t.ratio||1;e.save(),e.clearRect(0,0,t.width,t.height),e.drawImage(this.imageInfo.canvas,0,0),e.beginPath(),e.moveTo(0,0),e.lineTo(t.width,0),e.lineTo(t.width,t.height),e.lineTo(0,t.height),e.lineTo(0,0);var i=o.x*n,r=o.y*n,a=o.width*n,s=o.height*n;e.moveTo(i,r),e.lineTo(i,r+s),e.lineTo(i+a,r+s),e.lineTo(i+a,r),e.closePath(),e.fillStyle="rgba(0, 0, 0, 0.3)",e.fill(),e.restore()},l=function(t){o=t,this.clipBounds=o,s.call(this);var e=o.width/this.imageInfo.scale|0,n=o.height/this.imageInfo.scale|0;r.textContent=(o.x/this.imageInfo.scale|0)+", "+(o.y/this.imageInfo.scale|0)+", "+e+", "+n,this.updateOutputSize()};this.updateOutputSize=function(){var t=this._getChild(".graph-export-panel__export_scale"),e=t.value,n=o.width/this.imageInfo.scale*e|0,i=o.height/this.imageInfo.scale*e|0,r=n+" X "+i;n*i>12e6&&(r+="<span style='color: #F66;'>图幅太大，导出时可能出现内存不足</span>"),a.innerHTML=r};var h=new n(i.parentNode,l.bind(this));this.update=function(){var t=this.canvas.ratio||1,e=this.imageInfo.width/t,n=this.imageInfo.height/t;this.canvas.setSize(e,n),h.update(e,n)}},destroy:function(){this.graph=null,this.imageInfo=null,this.clipBounds=null,this.bounds=null},show:function(t){e(this.html).modal("show"),this.graph=t;var n=t.bounds;this.bounds=n;var i=this._getChild(".graph-export-panel__canvas_size");i.textContent=(0|n.width)+" X "+(0|n.height);var o,r=Math.min(500,screen.width/1.3);o=n.width>n.height?Math.min(1,r/n.width):Math.min(1,r/n.height),this.canvas||this.initCanvas(),this.imageInfo=t.exportImage(o*this.canvas.ratio),this.imageInfo.scale=o,this.update()}};var a;t.showExportPanel=o}(Q,jQuery),!function(t,e){var n=n||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(t){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var e=t.document,n=function(){return t.URL||t.webkitURL||t},i=e.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in i,r=function(n){var i=e.createEvent("MouseEvents");i.initMouseEvent("click",!0,!1,t,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(i)},a=t.webkitRequestFileSystem,s=t.requestFileSystem||a||t.mozRequestFileSystem,l=function(e){(t.setImmediate||t.setTimeout)(function(){throw e},0)},h="application/octet-stream",u=0,d=500,c=function(e){var i=function(){"string"==typeof e?n().revokeObjectURL(e):e.remove()};t.chrome?i():setTimeout(i,d)},p=function(t,e,n){e=[].concat(e);for(var i=e.length;i--;){var o=t["on"+e[i]];if("function"==typeof o)try{o.call(t,n||t)}catch(t){l(t)}}},f=function(e,l){var d,f,g,m=this,v=e.type,y=!1,_=function(){p(m,"writestart progress write writeend".split(" "))},b=function(){if(!y&&d||(d=n().createObjectURL(e)),f)f.location.href=d;else{var i=t.open(d,"_blank");void 0==i&&"undefined"!=typeof safari&&(t.location.href=d)}m.readyState=m.DONE,_(),c(d)},S=function(t){return function(){if(m.readyState!==m.DONE)return t.apply(this,arguments)}},E={create:!0,exclusive:!1};return m.readyState=m.INIT,l||(l="download"),o?(d=n().createObjectURL(e),i.href=d,i.download=l,r(i),m.readyState=m.DONE,_(),void c(d)):(t.chrome&&v&&v!==h&&(g=e.slice||e.webkitSlice,e=g.call(e,0,e.size,h),y=!0),a&&"download"!==l&&(l+=".download"),(v===h||a)&&(f=t),s?(u+=e.size,void s(t.TEMPORARY,u,S(function(t){t.root.getDirectory("saved",E,S(function(t){var n=function(){t.getFile(l,E,S(function(t){t.createWriter(S(function(n){n.onwriteend=function(e){f.location.href=t.toURL(),m.readyState=m.DONE,p(m,"writeend",e),c(t)},n.onerror=function(){var t=n.error;t.code!==t.ABORT_ERR&&b()},"writestart progress write abort".split(" ").forEach(function(t){n["on"+t]=m["on"+t]}),n.write(e),m.abort=function(){n.abort(),m.readyState=m.DONE},m.readyState=m.WRITING}),b)}),b)};t.getFile(l,{create:!1},S(function(t){t.remove(),n()}),S(function(t){t.code===t.NOT_FOUND_ERR?n():b()}))}),b)}),b)):void b())},g=f.prototype,m=function(t,e){return new f(t,e)};return g.abort=function(){var t=this;t.readyState=t.DONE,p(t,"abort")},g.readyState=g.INIT=0,g.WRITING=1,g.DONE=2,g.error=g.onwritestart=g.onprogress=g.onwrite=g.onabort=g.onerror=g.onwriteend=null,m}}("undefined"!=typeof self&&self||"undefined"!=typeof t&&t||this.content);"undefined"!=typeof module&&null!==module?module.exports=n:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return n}),t.saveAs=n}(window,document),!function(t){function e(e,n,i){var o=e.name;if(t.isString(n)){var r=new RegExp("."+n+"$","gi");if(!r.test(o))return void alert("Please selects ."+n+" file")}else n instanceof Function&&(i=n);var a=new FileReader;a.onload=function(t){i(a.result)},a.readAsText(e,"utf-8")}window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,t.isFileSupported=null!=window.requestFileSystem,t.isFileSupported&&(t.readerSingleFile=e)}(Q),GridBackground.prototype={update:function(){var t=this.graph,e=this.canvas,n=this.scaleCanvas;t.callLater(function(){e.setSize(t.width,t.height),e.width=e.width,n.setSize(t.width,t.height),n.width=e.width;var i=t.scale,o=50/i,r=this.currentCell=10*(Math.round(o/10)||1);i=t.scale*e.ratio;var a=t.viewportBounds,s=e.g;s.save(),this._doTransform(s,i,a),s.beginPath();var l=a.x,h=a.y,u=a.right,d=a.bottom;for(l%r!==0&&(l-=l%r),h%r!==0&&(h-=h%r);l<u;)s.moveTo(l,a.y),s.lineTo(l,d),l+=r;for(;h<d;)s.moveTo(a.x,h),s.lineTo(u,h),h+=r;s.lineWidth=1/i,s.strokeStyle="#CCC",s.stroke(),n.g.save(),this._doTransform(n.g,i,a),this.drawScales(n.g,a,i,n.ratio),n.g.restore(),s.restore()},this)},_doTransform:function(t,e,n){t.translate(-e*n.x,-e*n.y),t.scale(e,e)},drawText:function(t,e,n,i,o,r,a,s){o=o||7,t.save();var l=3;o*=l,t.font="normal "+o+"px helvetica arial",t.fillStyle="#555",t.textAlign=r||"center",t.textBaseline=a||"top",t.translate(n,i),s&&t.rotate(s),t.scale(1/l,1/l),t.fillText(e,0,0),t.restore()},drawScales:function(t,e,n,i){t.beginPath();var o=5*i/n,r=12*i/n;t.beginPath();var a=e.x;for(a=this.currentCell*Math.ceil(a/this.currentCell);a<e.right;)t.moveTo(a,e.y),t.lineTo(a,e.y+o+o),this.drawText(t,""+a|0,a,e.y+o+o,r),a+=this.currentCell;var s=e.y;for(s=this.currentCell*Math.ceil(s/this.currentCell);s<e.bottom;)t.moveTo(e.x,s),t.lineTo(e.x+o+o,s),this.drawText(t,""+s|0,e.x+o+o,s,r,"center","top",-Math.PI/6),s+=this.currentCell;t.lineWidth=1/n,t.strokeStyle="#000",t.stroke()}};var i18n={"zh-cn":{Name:"名称","Render Color":"渲染色",Border:"边框","Border Color":"边框颜色",Location:"坐标",Size:"尺寸",Rotate:"旋转","Label Color":"文本颜色","Background Color":"背景色","Font Size":"字体大小","json file is empty":"JSON文件为空","Save Error":"保存错误","Save Success":"保存成功",Update:"更新",Submit:"提交","Export JSON":"导出JSON","Load File ...":"加载文件 ...","Download File":"下载文件",Save:"保存",Rename:"重命名","Input Element Name":"输入图元名称","Solid Line":"实线样式","Dashed Line":"虚线样式","Line Width":"连线宽度","Input Line Width":"输入连线宽度","Line Color":"连线颜色","Input Line Color":"输入连线颜色","Out of Group":"脱离分组","Send to Top":"置顶显示","Send to Bottom":"置底显示","Reset Layer":"恢复默认层","Clear Graph":"清空画布","Zoom In":"放大","Zoom Out":"缩小","1:1":"1:1","Pan Mode":"平移模式","Rectangle Select":"框选模式",Text:"文字","Basic Nodes":"基本节点","Register Images":"注册图片","Default Shapes":"默认形状"}},lang=navigator.language||navigator.browserLanguage;lang=lang.toLowerCase(),!function(t,e,n){function i(t){this._refs={},t&&(this.root=t.root)}function o(t){if(!(t instanceof Object))return!t;if(Array.isArray(t))return 0==t.length;for(var e in t)return!1;return!0}function r(t,n){var i=t.split(".");n=n||e;for(var o=-1;n&&++o<i.length;){var r=i[o];n=n[r]}return n}function a(t,e,n){if(t._classPath=e,t instanceof Function&&(t.prototype._className=t._classPath,t.prototype._class=t),n!==!1)for(var i in t)if(!("_"==i[0]||"$"==i[0]||"superclass"==i||"constructor"==i||"prototype"==i||i.indexOf(".")>=0)){var o=t[i];o&&o instanceof Object&&!o._classPath&&a(o,e+"."+i)}}function s(t){var e=t._className;if(!e)return null;var n=p[e];if(!n){var i=t._class;n=p[e]=new i}return n}function l(t,e){return t==e||t&&e&&t.equals&&t.equals(e)}function h(t,e,n,i){var o=s(i);e.forEach(function(e){var r=i[e];if(!l(r,o[e])){var a=t.toJSON(r);!a&&r||(n[e]=a)}},i)}function u(t,e){var n;for(var i in e)n||(n={}),n[i]=t.toJSON(e[i]);return n}function d(t){t&&(this.withGlobalRefs=t.withGlobalRefs!==!1),this.reset()}function c(t,e){var n=new d,i={version:"2.0",refs:{}},r=[],a={};if(t.currentSubNetwork){var s=n.elementToJSON(t.currentSubNetwork);s&&(i.currentSubNetwork={_ref:s._refId=t.currentSubNetwork.id})}if(t.forEach(function(t){if(!e||e(t)!==!1){var i=n.elementToJSON(t);i&&(r.push(i),a[t.id]=i)}}),n._elementRefs)for(var l in n._elementRefs)a[l]._refId=l;n._globalRefs&&(i.refs=n._globalRefs),n.clearRef(),i.datas=r;for(var h in i)o(i[h])&&delete i[h];return i}if(!t.Graph.prototype.parseJSON){i.prototype={_refs:null,_index:1,root:null,reset:function(){this._refs={},this._index=1},getREF:function(t){return this._refs[t]},clearRef:function(){for(var t in this._refs){var e=this._refs[t],n=e._value;n&&(n._refed||delete e._refId,delete n._refed,delete n._refId,delete e._value)}this.reset()},toJSON:function(t){if(!(t instanceof Object))return t;if(t instanceof Function&&!t._classPath)return null;if(void 0!==t._refId)return t._refed=!0,{_ref:t._refId};var e=this._index++;t._refId=e;var n=this._toJSON(t);return n._refId=e,n._value=t,this._refs[e]=n,n},_toJSON:function(t){if(t._classPath)return{_classPath:t._classPath};if(!t._className)return t;var e={_className:t._className};return t.toJSON?e.json=t.toJSON(this):e.json=t,e},parseJSON:function(t){return t instanceof Object?void 0!==t._ref?this._refs[t._ref]:void 0!==t._refId?this._refs[t._refId]=this._parseJSON(t):this._parseJSON(t):t},_parseJSON:function(t){if(t._classPath)return r(t._classPath);if(t._className){var e=r(t._className),n=new e;if(void 0!==t._refId&&(this._refs[t._refId]=n),n&&t.json)if(t=t.json,n.parseJSON)n.parseJSON(t,this);else for(var i in t)n[i]=t[i];return n}return t}};var p={};t.HashList.prototype.toJSON=function(t){var e=[];return this.forEach(function(n){e.push(t.toJSON(n))}),e},t.HashList.prototype.parseJSON=function(t,e){var n=[];return t.forEach(function(t){var i=e.parseJSON(t);this.add(i),n.push(i)},this),n};var f={class:!1,id:!1,fillGradient:!1,syncSelectionStyles:!1,originalBounds:!1,parent:!1,font:!1,$data:!1,$x:!1,$y:!1};t.BaseUI.prototype.toJSON=function(t){var e={};for(var n in this)if("_"!=n[0]&&("$"!=n[0]||"_"!=n[1])&&0!=n.indexOf("$invalidate")&&f[n]!==!1){var i=this[n];if(!(i instanceof Function||i==this.class.prototype[n]))try{e[n]=t.toJSON(i)}catch(t){}}return e},t.BaseUI.prototype.parseJSON=function(t,e){for(var n in t){var i=e.parseJSON(t[n]);this[n]=i}};var g=["enableSubNetwork","zIndex","tooltipType","tooltip","movable","selectable","resizable","uiClass","name","parent","host"];t.Element.prototype.addOutProperty=function(t){this.outputProperties||(this.outputProperties=[]),this.outputProperties.push(t)},t.Element.prototype.toJSON=function(t){var e={},n=g;if(this.outputProperties&&(n=n.concat(this.outputProperties)),h(t,n,e,this),this.styles){var i=u(t,this.styles);i&&(e.styles=i)}if(this.properties){var o=u(t,this.properties);o&&(e.properties=o)}var r=this.bindingUIs;if(r){var a=[];r.forEach(function(e){var n=t.toJSON(e.ui);a.push({ui:n,bindingProperties:e.bindingProperties})}),e.bindingUIs=a}return e},t.Element.prototype.parseJSON=function(t,e){if(t.styles){var n={};for(var i in t.styles)n[i]=e.parseJSON(t.styles[i]);this.putStyles(n,!0)}if(t.properties){var o={};for(var i in t.properties)o[i]=e.parseJSON(t.properties[i]);this.properties=o}t.bindingUIs&&t.bindingUIs.forEach(function(t){var n=e.parseJSON(t.ui);n&&this.addUI(n,t.bindingProperties)},this);for(var i in t)if("styles"!=i&&"properties"!=i&&"bindingUIs"!=i){var r=e.parseJSON(t[i]);this[i]=r}},t.Node.prototype.toJSON=function(e){var n=t.doSuper(this,t.Node,"toJSON",arguments);return h(e,["location","size","image","rotate","anchorPosition"],n,this),n},t.Group.prototype.toJSON=function(e){var n=t.doSuper(this,t.Group,"toJSON",arguments);return h(e,["minSize","groupType","padding","groupImage","expanded"],n,this),n},t.ShapeNode.prototype.toJSON=function(e){var n=t.doSuper(this,t.Node,"toJSON",arguments);return h(e,["location","rotate","anchorPosition","path"],n,this),n},t.Edge.prototype.toJSON=function(e){var n=t.doSuper(this,t.Edge,"toJSON",arguments);return h(e,["from","to","edgeType","angle","bundleEnabled","pathSegments"],n,this),n},d.prototype={_refs:null,_refValues:null,_index:1,root:null,reset:function(){this._globalRefs={},this._elementRefs={},this._refs={},this._refValues={},this._index=1},getREF:function(t){return this._refs[t]},clearRef:function(){for(var t in this._globalRefs)delete this._globalRefs[t]._value;for(var t in this._refValues)delete this._refValues[t]._refId;this.reset()},elementToJSON:function(t){return this._toJSON(t)},_elementRefs:null,_globalRefs:null,withGlobalRefs:!0,toJSON:function(e){if(!(e instanceof Object))return e;if(e instanceof Function&&!e._classPath)return null;if(!this.withGlobalRefs)return this._toJSON(e);if(e instanceof t.Element)return this._elementRefs[e.id]=!0,{_ref:e.id};if(void 0===e._refId){var n=this._toJSON(e);if(!n)return n;var i=e._refId=this._index++;return this._refValues[i]=e,this._refs[i]=n,n}var i=e._refId;if(!this._globalRefs[i]){var n=this._refs[i];if(!n)return n;var o={};for(var r in n)o[r]=n[r],delete n[r];n.$ref=i,this._globalRefs[i]=o}return{$ref:i}},_toJSON:function(e){if(e._classPath)return{_classPath:e._classPath};if(!e._className){if(t.isArray(e)){var n=[];return e.forEach(function(t){n.push(this.toJSON(t))},this),n}n={};var i;e.class&&(i=e.class.prototype);for(var o in e){var r=e[o];r instanceof Function||i&&r==i[o]||(n[o]=this.toJSON(e[o]))}return n}var a={_className:e._className};return e.toJSON?a.json=e.toJSON(this):a.json=e,a},jsonToElement:function(t){return void 0!==t._refId&&t._refId in this._refs?this._refs[t._refId]:this._parseJSON(t)},parseJSON:function(t){if(!(t instanceof Object))return t;if(!this.withGlobalRefs)return this._parseJSON(t);if(void 0!==t.$ref){var e=this._globalRefs[t.$ref];if(!e)return;return void 0===e._value&&(e._value=this.parseJSON(e)),e._value}if(void 0!==t._ref){var n=this._elementRefs[t._ref];if(!n)return;return this.jsonToElement(n)}return this._parseJSON(t)},_parseJSON:function(e){if(!(e instanceof Object))return e;if(e._classPath)return r(e._classPath);if(e._className){var n=r(e._className),i=new n;if(this.withGlobalRefs&&void 0!==e._refId&&(this._refs[e._refId]=i),i&&e.json)if(e=e.json,i.parseJSON)i.parseJSON(e,this);else for(var o in e)i[o]=e[o];return i}if(t.isArray(e)){var a=[];return e.forEach(function(t){a.push(this.parseJSON(t))},this),a}var a={};for(var s in e)a[s]=this.parseJSON(e[s]);return a}},t.GraphModel.prototype.toJSON=function(t){return c(this,t)},t.GraphModel.prototype.parseJSON=function(e,n){n=n||{};var i=e.datas;if(i&&i.length>0){var o=[],r=new d(n,e.g),a={};if(i.forEach(function(t){t._refId&&(a[t._refId]=t)}),r._globalRefs=e.refs||{},r._elementRefs=a,i.forEach(function(e){var n=r.jsonToElement(e);n instanceof t.Element&&(o.push(n),this.add(n))},this),this.currentSubNetwork){var s=this.currentSubNetwork;o.forEach(function(t){t.parent||(t.parent=s)})}if(e.currentSubNetwork){var s=r.getREF(e.currentSubNetwork._ref);s&&(this.currentSubNetwork=s)}return r.clearRef(),o}},t.Graph.prototype.toJSON=t.Graph.prototype.exportJSON=function(t,e){e=e||{};var n=this.graphModel.toJSON(e.filter);return n.scale=this.scale,n.tx=this.tx,n.ty=this.ty,t&&(n=JSON.stringify(n,e.replacer,e.space||"\t")),n},t.Graph.prototype.parseJSON=function(e,n){t.isString(e)&&(e=JSON.parse(e)),n=n||{};var i=this.graphModel.parseJSON(e,n),o=e.scale;return o&&n.transform!==!1&&(this.originAtCenter=!1,this.translateTo(e.tx||0,e.ty||0,o)),i},a(t,"Q"),t.loadClassPath=a,t.exportJSON=function(t,e){try{var n=new d({withGlobalRefs:!1}).toJSON(t);return e?JSON.stringify(n):n}catch(t){}},t.parseJSON=function(e){try{return t.isString(e)&&(e=JSON.parse(e)),new d({withGlobalRefs:!1}).parseJSON(e)}catch(t){}}}}(Q,window,document),function(t){"use strict";function e(t){return t instanceof Number||"number"==typeof t}t.fn.borderLayout=function(){var n=function(n,i){n.style.position="absolute",n.style.boxSizing="border-box";for(var o in i){var r=i[o];e(r)&&(r=parseInt(r)+"px"),n.style[o]=r}t(n).trigger("size.change")},i=function(t,e){return"%"===t[t.length-1]?e*parseInt(t)/100:parseInt(t)},o=function(t,e,n,o){var r=i(t,e);return n&&(n=i(n,e),r<n)?n:o&&(o=i(o,e),r>o)?o:r};return this.each(function(){function e(){h&&(y=h._data.width,y&&(y=o(y,d,h._data["min-width"],h._data["max-width"]),N=y,_=parseInt(h._data.left)||0,_&&(b-=_,N+=_),b-=y,n(h,{top:E,left:_,width:y,height:S}))),l&&(y=l._data.width,y&&(y=o(y,d,l._data["min-width"],l._data["max-width"]),_=parseInt(l._data.right)||0,_&&(b-=_),b-=y,n(l,{top:E,right:_,width:y,height:S})))}function i(){a&&(y=a._data.height,y&&(y=o(y,c,a._data["min-height"],a._data["max-height"]),S-=y,E=y,n(a,{top:0,left:N,width:b,height:y}))),s&&(y=s._data.height,y&&(y=o(y,c,s._data["min-height"],s._data["max-height"]),S-=y,n(s,{bottom:0,left:N,height:y,width:b})))}this.style.boxSizing="border-box",this.style.overflow="hidden",(this==document.body||t(this).hasClass("layout--body"))&&n(this,{top:0,bottom:0,left:0,right:0});for(var r,a,s,l,h,u=t(this).hasClass("layout--h"),d=this.clientWidth,c=this.clientHeight,p=0,f=this.children;p<f.length;){var g=f[p++],m=g.getAttribute("data-options");if(m){m=m.replace(/(['"])?([a-zA-Z0-9\-]+)(['"])?:/g,'"$2":'),m=m.replace(/'/g,'"'),m="{"+m+"}";try{m=JSON.parse(m)}catch(t){continue}var v=m.region;v&&(g._data=m,/center/i.test(v)?r=g:/north/i.test(v)?a=g:/south/i.test(v)?s=g:/east/i.test(v)?l=g:/west/i.test(v)&&(h=g))}}var y,_,b=d,S=c,E=0,N=0;u?(e(),i()):(i(),e()),r&&n(r,{top:E,left:N,width:b,height:S})})},t(function(){t(".layout").borderLayout(),t(window).resize(function(){t(".layout").borderLayout()})})}(jQuery),function(t){function e(e,n,i){var o=document.documentElement,r=new t.Rect(window.pageXOffset,window.pageYOffset,o.clientWidth-2,o.clientHeight-2),a=e.offsetWidth,s=e.offsetHeight;n+a>r.x+r.width&&(n=r.x+r.width-a),i+s>r.y+r.height&&(i=r.y+r.height-s),n<r.x&&(n=r.x),i<r.y&&(i=r.y),e.style.left=n+"px",e.style.top=i+"px"}function n(t,e){for(var n=e.parentNode;null!=n;){if(n==t)return!0;n=n.parentNode}return!1}function i(t){return t.touches&&t.touches.length&&(t=t.touches[0]),{x:t.pageX,y:t.pageY}}function o(e,n){var o=n.popupmenu,r=i(e),a=r.x,s=r.y,l=o.getMenuItems(n,n.getElement(e),e);l&&(o.items=l,o.showAt(a,s),t.stopEvent(e))}var r=function(t){this.items=t||[]},a="dropdown-menu";r.Separator="divider",r.prototype={dom:null,_invalidateFlag:!0,add:function(t){this.items.push(t),this._invalidateFlag=!0},addSeparator:function(){this.add(r.Separator)},showAt:function(t,n){return!(!this.items||!this.items.length)&&(this._invalidateFlag&&this.render(),this.dom.style.display="block",document.body.appendChild(this.dom),void e(this.dom,t,n))},hide:function(){this.dom&&this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom)},isShowing:function(){return null!==this.dom.parentNode},render:function(){if(this._invalidateFlag=!1,this.dom)this.dom.innerHTML="";else{this.dom=document.createElement("ul"),this.dom.setAttribute("role","menu"),this.dom.className=a;var e=t.isTouchSupport?"touchstart":"mousedown";this.stopEditWhenClickOnWindow||(this.stopEditWhenClickOnWindow=function(t){this.isShowing()&&!n(this.dom,t.target)&&this.hide()}.bind(this)),window.addEventListener("mousedown",this.stopEditWhenClickOnWindow,!0),this.dom.addEventListener(e,function(e){t.stopEvent(e)},!1)}for(var i=0,o=this.items.length;i<o;i++){var r=this.renderItem(this.items[i]);this.dom.appendChild(r)}},html2Escape:function(t){return t.replace(/[<>&"]/g,function(t){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[t]})},renderItem:function(e,n){var i=document.createElement("li");if(i.setAttribute("role","presentation"),e==r.Separator)return i.className=r.Separator,i.innerHTML=" ",i;if(t.isString(e))return i.innerHTML='<a role="menuitem" tabindex="-1" href="#">'+this.html2Escape(e)+"</a>",i;e.selected&&(i.style.backgroundPosition="3px 5px",i.style.backgroundRepeat="no-repeat",i.style.backgroundImage="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAPklEQVQ4y2P4//8/AyWYYdQA7AYAAZuamlo7ED+H4naQGNEGQDX/R8PtpBjwHIsBz+lqAGVeoDgQR1MiaRgAnxW7Q0QEK0cAAAAASUVORK5CYII=')");var o=document.createElement("a");if(o.setAttribute("role","menuitem"),o.setAttribute("tabindex","-1"),o.setAttribute("href","javascript:void(0)"),i.appendChild(o),e.html)o.innerHTML=e.html;else{var a=e.text||e.name;a&&(o.innerHTML=this.html2Escape(a))}var s=e.className;s&&(i.className=s);var l=e.action,h=this,u=function(n){l&&l.call(e.scope,n,e),t.isIOS||n.target.focus(),setTimeout(function(){h.hide()},100)};return t.isTouchSupport?o.ontouchstart=u:i.onclick=u,i},getMenuItems:function(e,n,i){var o=[];if(n){var r=n instanceof t.ShapeNode,a=(n instanceof t.Group,!r&&n instanceof t.Node,n instanceof t.Edge);if(o.push({text:getI18NString("Rename"),action:function(e,i){t.prompt(getI18NString("Input Element Name"),n.name||"",function(t){null!==t&&(n.name=t)})}}),a){var s=n.getStyle(t.Styles.EDGE_LINE_DASH)||t.DefaultStyles[t.Styles.EDGE_LINE_DASH];o.push({text:getI18NString(s?"Solid Line":"Dashed Line"),action:function(e,i){n.setStyle(t.Styles.EDGE_LINE_DASH,s?null:[5,3])}}),o.push({text:getI18NString("Line Width"),
action:function(e,i){t.prompt(getI18NString("Input Line Width"),n.getStyle(t.Styles.EDGE_WIDTH)||t.DefaultStyles[t.Styles.EDGE_WIDTH],function(e){null!==e&&(e=parseFloat(e),n.setStyle(t.Styles.EDGE_WIDTH,e))})}}),o.push({text:getI18NString("Line Color"),action:function(e,i){t.prompt(getI18NString("Input Line Color"),n.getStyle(t.Styles.EDGE_COLOR)||t.DefaultStyles[t.Styles.EDGE_COLOR],function(e){null!==e&&n.setStyle(t.Styles.EDGE_COLOR,e)})}})}else n.parent instanceof t.Group&&o.push({text:getI18NString("Out of Group"),action:function(){n.parent=null}});o.push(t.PopupMenu.Separator),o.push({text:getI18NString("Send to Top"),action:function(t,i){n.zIndex=1,e.sendToTop(n),e.invalidate()}}),o.push({text:getI18NString("Send to Bottom"),action:function(t,i){n.zIndex=-1,e.sendToBottom(n),e.invalidate()}}),o.push({text:getI18NString("Reset Layer"),action:function(t,i){n.zIndex=0,e.invalidate()}}),o.push(t.PopupMenu.Separator)}o.push({text:getI18NString("Clear Graph"),action:function(){e.clear()}}),o.push(t.PopupMenu.Separator),o.push({text:getI18NString("Zoom In"),action:function(t,n){var i=e.globalToLocal(t);e.zoomIn(i.x,i.y,!0)}}),o.push({text:getI18NString("Zoom Out"),action:function(t,n){var i=e.globalToLocal(t);e.zoomOut(i.x,i.y,!0)}}),o.push({text:getI18NString("1:1"),action:function(t,n){e.globalToLocal(t);e.scale=1}}),o.push(t.PopupMenu.Separator);for(var l=e.interactionMode,h=[{text:getI18NString("Pan Mode"),value:t.Consts.INTERACTION_MODE_DEFAULT},{text:getI18NString("Rectangle Select"),value:t.Consts.INTERACTION_MODE_SELECTION}],u=0,d=h.length;u<d;u++){var c=h[u];c.value==l&&(c.selected=!0),c.action=function(t,n){e.interactionMode=n.value},o.push(c)}return o.push(t.PopupMenu.Separator),o.push({html:'<a href="http://qunee.com" target="_blank">Qunee - '+t.version+"</a>"}),o}},Object.defineProperties(r.prototype,{items:{get:function(){return this._items},set:function(t){this._items=t,this._invalidateFlag=!0}}});var s={onstart:function(t,e){e._popupmenu.hide()}};t.isTouchSupport&&(s.onlongpress=function(t,e){o(t,e)}),Object.defineProperties(t.Graph.prototype,{popupmenu:{get:function(){return this._popupmenu},set:function(t){this._popupmenu!=t&&(this._popupmenu=t,this._contextmenuListener||(this._contextmenuListener=s,this.addCustomInteraction(this._contextmenuListener),this.html.oncontextmenu=function(t){o(t,this)}.bind(this)))}}}),t.PopupMenu=r}(Q,jQuery),!function(t){function e(t,e,n,i,o){this.getter=n,this.setter=i,this.scope=o,this.property=t,this.createHtml(e)}function n(){t.doSuperConstructor(this,n,arguments)}function i(){t.doSuperConstructor(this,i,arguments)}function o(t,e){var n=t._classPath||t._tempName;return n||(n=t._tempName="class-"+S++),e?b[n]={class:t,properties:{}}:b[n]}function r(e,n){return n==t.Consts.PROPERTY_TYPE_STYLE?"S:"+e:n==t.Consts.PROPERTY_TYPE_CLIENT?"C:"+e:e}function a(e,n,i){var a=o(e,!0);n.forEach(function(e){var n;if(e.style)e.propertyType=t.Consts.PROPERTY_TYPE_STYLE,e.name=e.style;else if(e.client)e.propertyType=t.Consts.PROPERTY_TYPE_CLIENT,e.name=e.client;else{if(!e.name)return;e.propertyType=t.Consts.PROPERTY_TYPE_ACCESSOR}var n=e.key=r(e.name,e.propertyType);e.groupName||(e.groupName=i||"Element"),a.properties[n]=e})}function s(t){var e={};for(var n in b)if(t instanceof b[n].class){var i=b[n].properties;for(var o in i){var r=i[o];"none"==r.display?delete e[o]:e[o]=r}}return new l(e)}function l(t){this.properties=t;var e={};for(var n in t){var i=t[n].groupName,o=e[i];o||(o=e[i]={}),o[n]=t[n]}this.group=e}function h(e,n,i,o){return o&&o!=t.Consts.PROPERTY_TYPE_ACCESSOR?o==t.Consts.PROPERTY_TYPE_STYLE?e.getStyle(n,i):o==t.Consts.PROPERTY_TYPE_CLIENT?n.get(i):void 0:n[i]}function u(e,n,i,o){return o&&o!=t.Consts.PROPERTY_TYPE_ACCESSOR?o==t.Consts.PROPERTY_TYPE_STYLE?n.setStyle(i,e):o==t.Consts.PROPERTY_TYPE_CLIENT?n.set(i,e):void 0:n[i]=e}function d(e,n,i){this._formItems=[],this.html=n,this.form=t.createElement({class:"form-horizontal",parent:n,tagName:"form"}),this.graph=e,e.dataPropertyChangeDispatcher.addListener(function(t){this.onDataPropertyChange(t)}.bind(this)),e.selectionChangeDispatcher.addListener(function(t){this.datas=this.graph.selectionModel.toDatas()}.bind(this))}function c(t){return 0|t}function p(t,e){return t?"point"==e?c(t.x)+","+c(t.y):"size"==e?c(t.width)+","+c(t.height):"degree"==e?""+180*t/Math.PI|0:t.toString():t}function f(t,e){if("position"==e)return N[t];if("number"==e)return parseFloat(t)||0;if("boolean"==e)return!!t;if("point"!=e){if("size"!=e)return"degree"==e?parseInt(t)*Math.PI/180:t;var n=t.split(",");if(2==n.length){var i=parseFloat(n[0])||0,o=parseFloat(n[1])||0;if(i&&o)return{width:i,height:o}}}else{var n=t.split(",");if(2==n.length)return{x:parseFloat(n[0]||0),y:parseFloat(n[1])||0}}}e.prototype={_getValue:function(){return this.getter.call(this.scope)},update:function(){this.value=this._getValue()},setValue:function(t){this.input.value=p(t,this.property.type)},getValue:function(){return f(this.input.value,this.property.type)},createHtml:function(e){var n=this.property,i=t.createElement({tagName:"input",class:"form-control",parent:e});this.input=i,n.readonly&&i.setAttribute("readonly","readonly"),this.update(),$(i).on("input",function(t){this.ajdusting||this.setter.call(this.scope,this)}.bind(this))}},Object.defineProperties(e.prototype,{value:{get:function(){return this.getValue()},set:function(t){this.ajdusting=!0,this.setValue(t),this.ajdusting=!1}}}),n.prototype={setValue:function(t){this.input.setAttribute("checked",!!t&&"checked")},getValue:function(){return f(this.input.checked,this.property.type)},createHtml:function(e){var n=this.property,i=t.createElement({tagName:"input",parent:e});i.setAttribute("type","checkbox"),this.input=i,n.readonly&&i.setAttribute("readonly","readonly"),this.update(),$(i).on("click",function(t){this.ajdusting||this.setter.call(this.scope,this)}.bind(this))}},t.extend(n,e),i.prototype={createHtml:function(e){var n=t.createElement({tagName:"input",class:"form-control",parent:e});t.createElement({tagName:"span",parent:e,class:"input-group-addon",html:"<i></i>"}),this.input=n,this.update(),$(e).colorpicker().on("changeColor.colorpicker",function(t){this.ajdusting||this.setter.call(this.scope,this)}.bind(this))}},t.extend(i,e);var g=[{name:"name",displayName:"Name"},{style:t.Styles.LABEL_FONT_SIZE,type:"number",displayName:"Font Size"},{style:t.Styles.LABEL_COLOR,type:"color",displayName:"Label Color"},{style:t.Styles.RENDER_COLOR,type:"color",displayName:"Render Color"},{style:t.Styles.LABEL_POSITION,displayName:"Label Position"},{style:t.Styles.LABEL_ANCHOR_POSITION,displayName:"Label Anchor Position"}],m=[{name:"size",type:"size",displayName:"Size"},{name:"location",type:"point",displayName:"Location"},{name:"rotate",type:"number",displayName:"Rotate"},{style:t.Styles.BORDER,type:"number",displayName:"Border"},{style:t.Styles.BORDER_COLOR,type:"color",displayName:"Border Color"},{client:"status",type:"string",displayName:"状态"}],v=[{style:t.Styles.SHAPE_STROKE_STYLE,type:"color",displayName:"Stroke Color"},{style:t.Styles.SHAPE_STROKE,type:"number",displayName:"Stroke"}],y=[{name:"angle",type:"degree"},{style:t.Styles.BORDER,display:"none"},{style:t.Styles.EDGE_WIDTH,type:"number",displayName:"Edge Width"},{style:t.Styles.EDGE_COLOR,type:"color",displayName:"Edge Color"},{style:t.Styles.ARROW_TO,type:"boolean",displayName:"Arrow To"}],_=[{name:"size",display:"none"},{style:t.Styles.LABEL_SIZE,type:"size",displayName:"Size"},{style:t.Styles.RENDER_COLOR,display:"none"},{style:t.Styles.LABEL_BACKGROUND_COLOR,type:"color",displayName:"Background Color"}],b={},S=0;a(t.Element,g,"Element"),a(t.Node,m,"Node"),a(t.Edge,y,"Edge"),a(t.Text,_,"Text"),a(t.ShapeNode,v,"Shape"),l.prototype={contains:function(t,e){var n=r(t,e);return this.properties[n]}};var E=function(t,o,r,a,s){var l=t.type;return"color"==l?new i(t,o,r,a,s):"boolean"==l?new n(t,o,r,a,s):new e(t,o,r,a,s)},N={};for(var x in t.Position){var C=t.Position[x];"random"!=x&&C instanceof t.Position&&(N[C.toString()]=C)}d.prototype={_formItems:null,onValueChange:function(t,e){this.setValue(t,e)},adjusting:!1,_containsElement:function(t){for(var e in this.datas)if(e==t)return!0},_containsProperty:function(t,e){return this.propertyGroup&&this.propertyGroup.contains(t,e)},_cellEditors:null,_getCellEditors:function(t,e){if(this._cellEditors){var n=r(t,e);return this._cellEditors[n]}},onDataPropertyChange:function(e){if(!this.adjusting){if(!this.datas||!this.datas.length)return null;var n=e.source;if(!this._containsElement(n)){var i=this._getCellEditors(e.kind,e.propertyType);if(!i)return;t.isArray(i)||(i=[i]),i.forEach(function(t){t.update()})}}},clear:function(){$(".colorpicker-element").colorpicker("hide"),this.form.innerHTML="",this._formItems=[],this._cellEditors=null,this.form.style.display="none"},createItem:function(e,n){var i=t.createElement({class:"form-group",parent:e}),o=(t.createElement({parent:i,tagName:"label",class:"col-sm-6 control-label font-small",html:getI18NString(n.displayName||n.name)}),t.createElement({parent:i,class:"input-group input-group-sm col-sm-6"})),a=E(n,o,function(){return this.getValue(n)}.bind(this),function(t){this.onValueChange(t.value,n)}.bind(this)),s=r(n.name,n.propertyType);this._cellEditors||(this._cellEditors={});var l=this._cellEditors[s];return l?l.push(a):this._cellEditors[s]=[a],i},setValue:function(e,n){return this.datas&&this.datas.length?(this.adjusting=!0,n.type&&"string"!=n.type&&t.isString(e)&&(e=f(e,n.type)),this.datas.forEach(function(t){var i=h(this.graph,t,n.name,n.propertyType);i!==e&&u(e,t,n.name,n.propertyType)},this),void(this.adjusting=!1)):null},getValue:function(t){return this.datas&&this.datas.length?1==this.datas.length?h(this.graph,this.datas[0],t.name,t.propertyType)||"":void 0:null},createItemGroup:function(e,n){var i=t.createElement({class:"class-group",parent:this.form});t.createElement({tagName:"h4",parent:i,html:e});for(var e in n)this.createItem(i,n[e])}},Object.defineProperties(d.prototype,{datas:{get:function(){return this._datas},set:function(e){if(this._datas!=e&&(e&&!t.isArray(e)&&(e=[e]),this._datas=e,this.clear(),e.length&&1==e.length)){this.form.style.display="",this.propertyGroup=s(e[0]);var n=this.propertyGroup.group;for(var i in n)this.createItemGroup(i,n[i])}}}}),t.PropertyPane=d}(Q),function(t,e){function n(t,e,n,o,r){var a=document.createElement("div");a.className=o?"btn-group-vertical":"btn-group",r&&a.setAttribute("data-toggle","buttons");for(var s=0,l=t.length;s<l;s++)!t[s].type&&r&&(t[s].type="radio"),a.appendChild(i(t[s],n)).info=t[s];e.appendChild(a)}function i(n,i){if("search"==n.type){var o=document.createElement("div");o.style.display="inline-block",o.style.verticalAlign="middle",o.style.width="170px",o.innerHTML='<div class="input-group input-group-sm" >            <input type="text" class="form-control" placeholder="'+(n.placeholder||"")+'">                <span class="input-group-btn">                    <div class="btn btn-default" type="button"></div>                </span>            </div>';var r=o.getElementsByTagName("input")[0];n.id&&(r.id=n.id);var a=e(o).find(".btn")[0];if(n.iconClass){var s=document.createElement("div");e(s).addClass(n.iconClass),a.appendChild(s)}else n.name&&a.appendChild(document.createTextNode(" "+n.name));if(n.input=r,n.search){var l=function(){n.searchInfo=null},h=function(t){var e=r.value;if(!e)return void l();if(!n.searchInfo||n.searchInfo.value!=e){var i=n.search(e,n);if(!i||!i.length)return void l();n.searchInfo={value:e,result:i}}u(t)},u=function(t){if(n.select instanceof Function&&n.searchInfo&&n.searchInfo.result&&n.searchInfo.result.length){var e=n.searchInfo,i=n.searchInfo.result;if(1==i.length)return void n.select(i[0],0);void 0===e.index?e.index=0:(e.index+=t?-1:1,e.index<0&&(e.index+=i.length),e.index%=i.length),n.select(i[e.index],e.index)===!1&&(n.searchInfo=null,h())}};r.onkeydown=function(e){return 27==e.keyCode?(l(),r.value="",void t.stopEvent(e)):void(13==e.keyCode&&h(e.shiftKey))},a.onclick=function(t){h()}}return o}if("file"==n.type){var d=document.createElement("span"),r=document.createElement("input");if(d.className="file-input btn btn-default btn-sm btn-file",r.setAttribute("type","file"),r.className="btn-file",n.action&&(r.onchange=function(t){var o=e(this),r=o.get(0).files;d=o.val().replace(/\\/g,"/").replace(/.*\//,""),r.length&&n.action.call(i,r,d,t)}),d.appendChild(r),n.icon){var s=document.createElement("img");s.src=n.icon,d.appendChild(s)}else if(n.iconClass){var s=document.createElement("div");e(s).addClass(n.iconClass),d.appendChild(s)}else n.name&&d.appendChild(document.createTextNode(" "+n.name));return n.name&&d.setAttribute("title",n.name),d}if("input"==n.type){var o=document.createElement("div");o.style.display="inline-block",o.style.verticalAlign="middle",o.innerHTML='<div class="input-group input-group-sm" style="width: 150px;">            <input type="text" class="form-control">                <span class="input-group-btn">                    <button class="btn btn-default" type="button"></button>                </span>            </div>';var r=o.getElementsByTagName("input")[0],a=o.getElementsByTagName("button")[0];return a.innerHTML=n.name,n.input=r,n.action&&(a.onclick=function(t){n.action.call(i||window.graph,t,n)}),o}if("select"==n.type){var o=document.createElement("select");o.className="form-control";var c=n.options;return c.forEach(function(t){var e=document.createElement("option");e.innerHTML=t,e.value=t,o.appendChild(e)}),o.value=n.value,n.action&&(o.onValueChange=function(t){n.action.call(i||window.graph,t,n)}),o}if(n.type){var d=document.createElement("label"),a=document.createElement("input");n.input=a,a.setAttribute("type",n.type),d.appendChild(a),n.selected&&(a.setAttribute("checked","checked"),"radio"==n.type&&(d.className+="active"))}else var d=document.createElement("div");if(d.className+="btn btn-default btn-sm",n.icon){var s=document.createElement("img");s.src=n.icon,d.appendChild(s)}else if(n.iconClass){var s=document.createElement("div");e(s).addClass(n.iconClass),d.appendChild(s)}else n.name&&d.appendChild(document.createTextNode(" "+n.name));return n.name&&d.setAttribute("title",n.name),n.action&&((a||d).onclick=function(t){n.action.call(i||window.graph,t,n)}),d}function o(o,r,a){function s(){return r.graph}function l(){var n=s(),i=n?n.interactionMode:null;e(r).find(".btn").each(function(e,n){i&&n.info&&n.info.interactionMode==i?t.appendClass(n,"active"):t.removeClass(n,"active")})}function h(t){"interactionMode"==t.kind&&l()}function u(t,e,n){var i=s();i&&(i.interactionMode=e.value,i.interactionProperties=n||e)}function d(e,o,r,a,s){for(var l in e){var h=e[l];t.isArray(h)?(h.forEach(function(t){t.interactionMode&&(t.value=t.interactionMode,t.action=u)}),n(h,o,r,a,s)):(h.interactionMode&&(h.value=h.interactionMode,h.action=u),o.appendChild(i(h,r)).info=h)}}r.setGraph=function(t){var e=this.graph;e&&e.propertyChangeDispatcher.removeListener(h,this),this.graph=t,l(),t&&t.propertyChangeDispatcher.addListener(h,this)};var c={interactionModes:[{name:"默认模式",interactionMode:t.Consts.INTERACTION_MODE_DEFAULT,selected:!0,iconClass:"q-icon toolbar-default"},{name:"框选模式",interactionMode:t.Consts.INTERACTION_MODE_SELECTION,iconClass:"q-icon toolbar-rectangle_selection"},{name:"浏览模式",interactionMode:t.Consts.INTERACTION_MODE_VIEW,iconClass:"q-icon toolbar-pan"}],zoom:[{name:"放大",iconClass:"q-icon toolbar-zoomin",action:function(){s().zoomIn()}},{name:"缩小",iconClass:"q-icon toolbar-zoomout",action:function(){s().zoomOut()}},{name:"1:1",iconClass:"q-icon toolbar-zoomreset",action:function(){s().scale=1}},{name:"纵览",iconClass:"q-icon toolbar-overview",action:function(){s().zoomToOverview()}}],editor:[{name:"创建连线",interactionMode:t.Consts.INTERACTION_MODE_CREATE_EDGE,iconClass:"q-icon toolbar-edge"},{name:"创建L型连线",interactionMode:t.Consts.INTERACTION_MODE_CREATE_SIMPLE_EDGE,iconClass:"q-icon toolbar-edge_VH",edgeType:t.Consts.EDGE_TYPE_VERTICAL_HORIZONTAL},{name:"创建多边形",interactionMode:t.Consts.INTERACTION_MODE_CREATE_SHAPE,iconClass:"q-icon toolbar-polygon"},{name:"创建线条",interactionMode:t.Consts.INTERACTION_MODE_CREATE_LINE,iconClass:"q-icon toolbar-line"}],search:{name:"Find",placeholder:"Name",iconClass:"q-icon toolbar-search",type:"search",id:"search_input",search:function(t,e){var n=[],i=new RegExp(t,"i");return s().forEach(function(t){t.name&&i.test(t.name)&&n.push(t.id)}),n},select:function(t){if(t=s().graphModel.getById(t),!t)return!1;s().setSelection(t),s().sendToTop(t);var e=s().getUIBounds(t);e&&s().centerTo(e.cx,e.cy,Math.max(2,s().scale),!0)}},exportImage:{name:"导出图片",iconClass:"q-icon toolbar-print",action:function(){t.showExportPanel(s())}}};if(a)for(var p in a)c[p]=a[p];return d(c,r,this,!1,!1),r.setGraph(o),r}t.createToolbar=o,t.createButtonGroup=n,t.createButton=i}(Q,jQuery),!function(t,e){function n(t){if(!t)return s;var e={};for(var n in s)e[n]=s[n];for(var n in t){var i=l[n];i&&(e[i]=t[n])}return e}function i(t,n){t&&(void 0===n&&(n=e(t).hasClass("group--closed")),n?e(t).removeClass("group--closed"):e(t).addClass("group--closed"))}function o(e){return t.isString(e)||e.draw instanceof Function}var r=function(t,n,i,o){var r=document.createElement(i||"div");return r.className=t,e(r).html(o),n&&n.appendChild(r),r},a=function(t,e,n){if(Array.isArray(t))return t.forEach(function(t){e.call(this,t)},n);for(var i in t)e.call(n,t[i],i)},s={fillColor:"#EEE",lineWidth:1,strokeStyle:"#2898E0",padding:{left:1,top:1,right:5,bottom:5},shadowColor:"#888",shadowOffsetX:2,shadowOffsetY:2,shadowBlur:3},l={};l[t.Styles.RENDER_COLOR]="renderColor",l[t.Styles.RENDER_COLOR_BLEND_MODE]="renderColorBlendMode",l[t.Styles.SHAPE_FILL_COLOR]="fillColor",l[t.Styles.SHAPE_STROKE_STYLE]="strokeStyle",l[t.Styles.SHAPE_LINE_DASH]="borderLineDash",l[t.Styles.SHAPE_LINE_DASH_OFFSET]="borderLineDashOffset",l[t.Styles.SHAPE_OUTLINE]="outline",l[t.Styles.SHAPE_OUTLINE_STYLE]="outlineStyle",l[t.Styles.LINE_CAP]="lineGap",l[t.Styles.LINE_JOIN]="lineJoin",l[t.Styles.BACKGROUND_COLOR]="backgroundColor",l[t.Styles.BACKGROUND_GRADIENT]="backgroundGradient",l[t.Styles.BORDER]="border",l[t.Styles.BORDER_COLOR]="borderColor",l[t.Styles.BORDER_LINE_DASH]="borderLineDash",l[t.Styles.BORDER_LINE_DASH_OFFSET]="borderLineDashOffset";var h=function(t){for(var n=t.target.parentNode;n&&!e(n).hasClass("group");)n=n.parentNode;i(n)},u=function(t,e,n){this.graph=t,this.html=e,this.init(n)};u.prototype={loadButton:null,imageWidth:40,imageHeight:40,loadImageBoxes:function(e){return t.isArray(e)?void a(e,function(t){this.loadImageBox(t)},this):void this.loadImageBox(e)},loadImageBox:function(e,n){if(t.isString(e)&&(e=JSON.parse(e)),n){var i=this.html.getElementsByClassName("group").item(0);if(i)return void this.html.insertBefore(this._createGroup(e,e.prefix),i)}return this.html.appendChild(this._createGroup(e,e.prefix))},loadImageBoxFile:function(e){e[0]&&t.readerSingleFile(e[0],"json",function(t){t&&this.loadImageBox(t,!0)}.bind(this))},hideButtonBar:function(t){this.buttonBar.style.display=t?"":"none"},init:function(e){var n=this.html;this.graph;t.appendClass(n,"graph-editor__toolbox");var i=this.buttonBar=r("graph-editor__toolbox-buttonBar",n),o=this.loadButton=t.createButton({type:"file",name:getI18NString("Load Images..."),iconClass:"q-icon toolbar-add",action:this.loadImageBoxFile.bind(this)},this);i.appendChild(o),this.hideButtonBar();var a=[{label:"Node",image:"Q-node"},{type:"Text",label:"Text",html:'<span style="background-color: #2898E0; color:#FFF; padding: 3px 5px;">'+getI18NString("Text")+"</span>",styles:{"label.background.color":"#2898E0","label.color":"#FFF","label.padding":new t.Insets(3,5)}},{type:"Group",label:"Group",image:"Q-group"},{label:"SubNetwork",image:"Q-subnetwork",properties:{enableSubNetwork:!0}}],s=[{prefix:"Q-",name:"basic.nodes",displayName:getI18NString("Basic Nodes"),images:a},{prefix:"Q-",name:"register.images",displayName:getI18NString("Register Images"),images:t.getAllImages(),close:!0},{name:"default.shapes",displayName:getI18NString("Default Shapes"),prefix:"Q-",images:t.Shapes.getAllShapes(this.imageWidth,this.imageHeight),close:!0}];this.loadImageBoxes(s),e&&this.loadImageBoxes(e),t.Shapes.getShape(t.Consts.SHAPE_CIRCLE,100,100)},_index:0,_getGroup:function(t){return this._groups[t]},hideDefaultGroups:function(){this.hideGroup("basic.nodes"),this.hideGroup("register.images"),this.hideGroup("default.shapes")},hideGroup:function(t){var e=this._getGroup(t);e&&(e.style.display="none")},showGroup:function(t){var e=this._getGroup(t);e&&(e.style.display="")},_groups:{},_createGroup:function(e){var s=e.name,l=e.root,u=e.images,d=e.close,c=e.displayName||s,p=r("group");p.id=s,this._groups[s]=p;var f=r("group__title",p);f.onclick=h,r(null,f,"span",c),r("q-icon group-expand toolbar-expand",f,"span");var g=r("group__items",p),m=document.createElement("div");if(m.style.clear="both",p.appendChild(m),d&&i(p),!u)return p;var v=e.imageWidth||this.imageWidth,y=e.imageHeight||this.imageHeight,_=e.showLabel;return a(u,function(i,a){if("_classPath"!=a&&"_className"!=a){var s;s=o(i)?i:i.image;var h,u;if(s){var d;t.isString(s)?(d=s,!t.hasImage(s)&&l&&(d=s=l+s)):d=i.imageName||i.name||a||"drawable-"+this._index++,t.hasImage(d)||t.registerImage(d,s),h=t.createCanvas(v,y,!0),t.drawImage(d,h,n(i.styles)),o(i)?i={image:d}:i.image=d,e.size&&(i.properties||(i.properties={}),i.properties.size||(i.properties.size=e.size)),u=d}else{if(!i.html)return;var h=document.createElement("div");h.style.width=v+"px",h.style.height=y+"px",h.style.lineHeight=y+"px",h.style.overflow="hidden",h.innerHTML=i.html}u=i.tooltip||i.label||u||a,h.setAttribute("title",u);var c=r("group__item",g);if(t.appendDNDInfo(h,i),c.appendChild(h),i.br){var p=document.createElement("br");g.appendChild(p)}if(u&&(_||i.showLabel)){var f=u,m=10;f.length>m&&(f="..."+f.substring(f.length-m+2));var b=document.createElement("div");b.style.lineHeight="1em",b.style.overFlow="hide",b.style.marginTop="0px",b.textContent=f,c.appendChild(b)}}},this),p}},t.ToolBox=u}(Q,jQuery);